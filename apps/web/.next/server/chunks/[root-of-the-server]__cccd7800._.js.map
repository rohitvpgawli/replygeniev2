{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///Users/rohitgawli/Documents/GitHub/replygeniev2/apps/web/lib/db/schema.ts"],"sourcesContent":["import {\n  pgTable,\n  serial,\n  varchar,\n  text,\n  timestamp,\n  integer,\n  boolean,\n  jsonb,\n  index,\n  unique,\n} from 'drizzle-orm/pg-core';\nimport { relations } from 'drizzle-orm';\n\nexport const users = pgTable('users', {\n  id: serial('id').primaryKey(),\n  name: varchar('name', { length: 100 }),\n  email: varchar('email', { length: 255 }).notNull().unique(),\n  passwordHash: text('password_hash').notNull(),\n  role: varchar('role', { length: 20 }).notNull().default('member'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n  deletedAt: timestamp('deleted_at'),\n});\n\nexport const teams = pgTable('teams', {\n  id: serial('id').primaryKey(),\n  name: varchar('name', { length: 100 }).notNull(),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n  stripeCustomerId: text('stripe_customer_id').unique(),\n  stripeSubscriptionId: text('stripe_subscription_id').unique(),\n  stripeProductId: text('stripe_product_id'),\n  planName: varchar('plan_name', { length: 50 }),\n  subscriptionStatus: varchar('subscription_status', { length: 20 }),\n  brandVoiceGuidance: text('brand_voice_guidance'),\n  contactChannel: varchar('contact_channel', { length: 255 }),\n});\n\nexport const teamMembers = pgTable('team_members', {\n  id: serial('id').primaryKey(),\n  userId: integer('user_id')\n    .notNull()\n    .references(() => users.id),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  role: varchar('role', { length: 50 }).notNull(),\n  joinedAt: timestamp('joined_at').notNull().defaultNow(),\n});\n\nexport const activityLogs = pgTable('activity_logs', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  userId: integer('user_id').references(() => users.id),\n  action: text('action').notNull(),\n  timestamp: timestamp('timestamp').notNull().defaultNow(),\n  ipAddress: varchar('ip_address', { length: 45 }),\n});\n\nexport const invitations = pgTable('invitations', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  email: varchar('email', { length: 255 }).notNull(),\n  role: varchar('role', { length: 50 }).notNull(),\n  invitedBy: integer('invited_by')\n    .notNull()\n    .references(() => users.id),\n  invitedAt: timestamp('invited_at').notNull().defaultNow(),\n  status: varchar('status', { length: 20 }).notNull().default('pending'),\n});\n\n// ReplyGenie Tables\nexport const rcConnections = pgTable('rc_connections', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  provider: varchar('provider', { length: 50 }).notNull().default('google'),\n  accessToken: text('access_token'), // Encrypted\n  refreshToken: text('refresh_token'), // Encrypted\n  tokenExpiresAt: timestamp('token_expires_at'),\n  scope: text('scope'),\n  connectedBy: integer('connected_by')\n    .notNull()\n    .references(() => users.id),\n  connectedAt: timestamp('connected_at').notNull().defaultNow(),\n  lastSyncAt: timestamp('last_sync_at'),\n  status: varchar('status', { length: 20 }).notNull().default('active'),\n});\n\nexport const rcLocations = pgTable('rc_locations', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  connectionId: integer('connection_id')\n    .notNull()\n    .references(() => rcConnections.id),\n  googleLocationId: varchar('google_location_id', { length: 255 }).notNull(),\n  name: varchar('name', { length: 255 }).notNull(),\n  address: text('address'),\n  phoneNumber: varchar('phone_number', { length: 50 }),\n  websiteUrl: text('website_url'),\n  isVerified: boolean('is_verified').notNull().default(false),\n  syncCursor: timestamp('sync_cursor'), // For incremental sync\n  lastSyncAt: timestamp('last_sync_at'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n}, (table) => ({\n  googleLocationIdIdx: index('rc_locations_google_location_id_idx').on(table.googleLocationId),\n  teamIdIdx: index('rc_locations_team_id_idx').on(table.teamId),\n}));\n\nexport const rcReviews = pgTable('rc_reviews', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  locationId: integer('location_id')\n    .notNull()\n    .references(() => rcLocations.id),\n  googleReviewId: varchar('google_review_id', { length: 255 }).notNull().unique(),\n  reviewerName: varchar('reviewer_name', { length: 255 }),\n  reviewerProfilePhotoUrl: text('reviewer_profile_photo_url'),\n  starRating: integer('star_rating').notNull(),\n  comment: text('comment'),\n  reviewCreateTime: timestamp('review_create_time').notNull(),\n  reviewUpdateTime: timestamp('review_update_time'),\n  replied: boolean('replied').notNull().default(false),\n  status: varchar('status', { length: 20 }).notNull().default('pending'), // pending, drafted, posted\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n}, (table) => ({\n  locationIdCreateTimeIdx: index('rc_reviews_location_id_create_time_idx').on(table.locationId, table.reviewCreateTime),\n  googleReviewIdIdx: index('rc_reviews_google_review_id_idx').on(table.googleReviewId),\n  teamIdIdx: index('rc_reviews_team_id_idx').on(table.teamId),\n}));\n\nexport const rcDrafts = pgTable('rc_drafts', {\n  id: serial('id').primaryKey(),\n  reviewId: integer('review_id')\n    .notNull()\n    .references(() => rcReviews.id),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  draftText: text('draft_text').notNull(),\n  wordCount: integer('word_count').notNull(),\n  charCount: integer('char_count').notNull(),\n  riskFlags: jsonb('risk_flags'), // { hasUrl: boolean, hasProfanity: boolean, tooLong: boolean }\n  generatedBy: varchar('generated_by', { length: 50 }).notNull().default('ai'), // ai, user\n  generatedAt: timestamp('generated_at').notNull().defaultNow(),\n  editedBy: integer('edited_by').references(() => users.id),\n  editedAt: timestamp('edited_at'),\n});\n\nexport const rcReplies = pgTable('rc_replies', {\n  id: serial('id').primaryKey(),\n  reviewId: integer('review_id')\n    .notNull()\n    .references(() => rcReviews.id),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  replyText: text('reply_text').notNull(),\n  postedBy: integer('posted_by')\n    .notNull()\n    .references(() => users.id),\n  postedAt: timestamp('posted_at').notNull().defaultNow(),\n  googleReplyId: varchar('google_reply_id', { length: 255 }),\n  googleUpdateTime: timestamp('google_update_time'),\n}, (table) => ({\n  reviewIdUnique: unique('rc_replies_review_id_unique').on(table.reviewId),\n}));\n\nexport const rcUsage = pgTable('rc_usage', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  month: varchar('month', { length: 7 }).notNull(), // YYYY-MM format\n  postsCount: integer('posts_count').notNull().default(0),\n  draftsCount: integer('drafts_count').notNull().default(0),\n  quotaLimit: integer('quota_limit').notNull().default(50),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n}, (table) => ({\n  teamIdMonthUnique: unique('rc_usage_team_id_month_unique').on(table.teamId, table.month),\n}));\n\nexport const rcAuditLogs = pgTable('rc_audit_logs', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  userId: integer('user_id').references(() => users.id),\n  action: varchar('action', { length: 100 }).notNull(), // DRAFT_GENERATED, REPLY_POSTED, LOCATION_SYNCED, etc.\n  entityType: varchar('entity_type', { length: 50 }).notNull(), // review, draft, reply, location, connection\n  entityId: integer('entity_id'),\n  oldValue: jsonb('old_value'),\n  newValue: jsonb('new_value'),\n  metadata: jsonb('metadata'),\n  ipAddress: varchar('ip_address', { length: 45 }),\n  userAgent: text('user_agent'),\n  timestamp: timestamp('timestamp').notNull().defaultNow(),\n}, (table) => ({\n  teamIdTimestampIdx: index('rc_audit_logs_team_id_timestamp_idx').on(table.teamId, table.timestamp),\n}));\n\nexport const teamsRelations = relations(teams, ({ many }) => ({\n  teamMembers: many(teamMembers),\n  activityLogs: many(activityLogs),\n  invitations: many(invitations),\n}));\n\nexport const usersRelations = relations(users, ({ many }) => ({\n  teamMembers: many(teamMembers),\n  invitationsSent: many(invitations),\n}));\n\nexport const invitationsRelations = relations(invitations, ({ one }) => ({\n  team: one(teams, {\n    fields: [invitations.teamId],\n    references: [teams.id],\n  }),\n  invitedBy: one(users, {\n    fields: [invitations.invitedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const teamMembersRelations = relations(teamMembers, ({ one }) => ({\n  user: one(users, {\n    fields: [teamMembers.userId],\n    references: [users.id],\n  }),\n  team: one(teams, {\n    fields: [teamMembers.teamId],\n    references: [teams.id],\n  }),\n}));\n\nexport const activityLogsRelations = relations(activityLogs, ({ one }) => ({\n  team: one(teams, {\n    fields: [activityLogs.teamId],\n    references: [teams.id],\n  }),\n  user: one(users, {\n    fields: [activityLogs.userId],\n    references: [users.id],\n  }),\n}));\n\nexport type User = typeof users.$inferSelect;\nexport type NewUser = typeof users.$inferInsert;\nexport type Team = typeof teams.$inferSelect;\nexport type NewTeam = typeof teams.$inferInsert;\nexport type TeamMember = typeof teamMembers.$inferSelect;\nexport type NewTeamMember = typeof teamMembers.$inferInsert;\nexport type ActivityLog = typeof activityLogs.$inferSelect;\nexport type NewActivityLog = typeof activityLogs.$inferInsert;\nexport type Invitation = typeof invitations.$inferSelect;\nexport type NewInvitation = typeof invitations.$inferInsert;\nexport type TeamDataWithMembers = Team & {\n  teamMembers: (TeamMember & {\n    user: Pick<User, 'id' | 'name' | 'email'>;\n  })[];\n};\n\nexport enum ActivityType {\n  SIGN_UP = 'SIGN_UP',\n  SIGN_IN = 'SIGN_IN',\n  SIGN_OUT = 'SIGN_OUT',\n  UPDATE_PASSWORD = 'UPDATE_PASSWORD',\n  DELETE_ACCOUNT = 'DELETE_ACCOUNT',\n  UPDATE_ACCOUNT = 'UPDATE_ACCOUNT',\n  CREATE_TEAM = 'CREATE_TEAM',\n  REMOVE_TEAM_MEMBER = 'REMOVE_TEAM_MEMBER',\n  INVITE_TEAM_MEMBER = 'INVITE_TEAM_MEMBER',\n  ACCEPT_INVITATION = 'ACCEPT_INVITATION',\n}\n\n// ReplyGenie Types\nexport type RcConnection = typeof rcConnections.$inferSelect;\nexport type NewRcConnection = typeof rcConnections.$inferInsert;\nexport type RcLocation = typeof rcLocations.$inferSelect;\nexport type NewRcLocation = typeof rcLocations.$inferInsert;\nexport type RcReview = typeof rcReviews.$inferSelect;\nexport type NewRcReview = typeof rcReviews.$inferInsert;\nexport type RcDraft = typeof rcDrafts.$inferSelect;\nexport type NewRcDraft = typeof rcDrafts.$inferInsert;\nexport type RcReply = typeof rcReplies.$inferSelect;\nexport type NewRcReply = typeof rcReplies.$inferInsert;\nexport type RcUsage = typeof rcUsage.$inferSelect;\nexport type NewRcUsage = typeof rcUsage.$inferInsert;\nexport type RcAuditLog = typeof rcAuditLogs.$inferSelect;\nexport type NewRcAuditLog = typeof rcAuditLogs.$inferInsert;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 438, "column": 0}, "map": {"version":3,"sources":["file:///Users/rohitgawli/Documents/GitHub/replygeniev2/apps/web/lib/db/drizzle.ts"],"sourcesContent":["import { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport * as schema from './schema';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nif (!process.env.POSTGRES_URL) {\n  throw new Error('POSTGRES_URL environment variable is not set');\n}\n\nexport const client = postgres(process.env.POSTGRES_URL);\nexport const db = drizzle(client, { schema });\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,2LAAA,CAAA,UAAM,CAAC,MAAM;AAEb,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,SAAS,CAAA,GAAA,+LAAA,CAAA,UAAQ,AAAD,EAAE,QAAQ,GAAG,CAAC,YAAY;AAChD,MAAM,KAAK,CAAA,GAAA,gPAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;IAAE,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 462, "column": 0}, "map": {"version":3,"sources":["file:///Users/rohitgawli/Documents/GitHub/replygeniev2/apps/web/lib/auth/session.ts"],"sourcesContent":["import { compare, hash } from 'bcryptjs';\nimport { SignJWT, jwtVerify } from 'jose';\nimport { cookies } from 'next/headers';\nimport { NewUser } from '@/lib/db/schema';\n\nconst key = new TextEncoder().encode(process.env.AUTH_SECRET);\nconst SALT_ROUNDS = 10;\n\nexport async function hashPassword(password: string) {\n  return hash(password, SALT_ROUNDS);\n}\n\nexport async function comparePasswords(\n  plainTextPassword: string,\n  hashedPassword: string\n) {\n  return compare(plainTextPassword, hashedPassword);\n}\n\ntype SessionData = {\n  user: { id: number };\n  expires: string;\n};\n\nexport async function signToken(payload: SessionData) {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: 'HS256' })\n    .setIssuedAt()\n    .setExpirationTime('1 day from now')\n    .sign(key);\n}\n\nexport async function verifyToken(input: string) {\n  const { payload } = await jwtVerify(input, key, {\n    algorithms: ['HS256'],\n  });\n  return payload as SessionData;\n}\n\nexport async function getSession() {\n  const session = (await cookies()).get('session')?.value;\n  if (!session) return null;\n  return await verifyToken(session);\n}\n\nexport async function setSession(user: NewUser) {\n  const expiresInOneDay = new Date(Date.now() + 24 * 60 * 60 * 1000);\n  const session: SessionData = {\n    user: { id: user.id! },\n    expires: expiresInOneDay.toISOString(),\n  };\n  const encryptedSession = await signToken(session);\n  (await cookies()).set('session', encryptedSession, {\n    expires: expiresInOneDay,\n    httpOnly: true,\n    secure: true,\n    sameSite: 'lax',\n  });\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;AACA;;;;AAGA,MAAM,MAAM,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,WAAW;AAC5D,MAAM,cAAc;AAEb,eAAe,aAAa,QAAgB;IACjD,OAAO,CAAA,GAAA,wLAAA,CAAA,OAAI,AAAD,EAAE,UAAU;AACxB;AAEO,eAAe,iBACpB,iBAAyB,EACzB,cAAsB;IAEtB,OAAO,CAAA,GAAA,wLAAA,CAAA,UAAO,AAAD,EAAE,mBAAmB;AACpC;AAOO,eAAe,UAAU,OAAoB;IAClD,OAAO,MAAM,IAAI,wMAAA,CAAA,UAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,kBAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAA,GAAA,0MAAA,CAAA,YAAS,AAAD,EAAE,OAAO,KAAK;QAC9C,YAAY;YAAC;SAAQ;IACvB;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,CAAC,MAAM,CAAA,GAAA,gRAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,YAAY;IAClD,IAAI,CAAC,SAAS,OAAO;IACrB,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe,WAAW,IAAa;IAC5C,MAAM,kBAAkB,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;IAC7D,MAAM,UAAuB;QAC3B,MAAM;YAAE,IAAI,KAAK,EAAE;QAAE;QACrB,SAAS,gBAAgB,WAAW;IACtC;IACA,MAAM,mBAAmB,MAAM,UAAU;IACzC,CAAC,MAAM,CAAA,GAAA,gRAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,WAAW,kBAAkB;QACjD,SAAS;QACT,UAAU;QACV,QAAQ;QACR,UAAU;IACZ;AACF","debugId":null}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":["file:///Users/rohitgawli/Documents/GitHub/replygeniev2/apps/web/app/api/auth/google/callback/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/lib/db/drizzle';\nimport { users, teams, teamMembers } from '@/lib/db/schema';\nimport { eq } from 'drizzle-orm';\nimport { setSession } from '@/lib/auth/session';\n\nconst GOOGLE_TOKEN_URL = 'https://oauth2.googleapis.com/token';\nconst GOOGLE_USERINFO_URL = 'https://www.googleapis.com/oauth2/v2/userinfo';\n\ninterface GoogleTokenResponse {\n  access_token: string;\n  expires_in: number;\n  scope: string;\n  token_type: string;\n}\n\ninterface GoogleUserInfo {\n  id: string;\n  email: string;\n  verified_email: boolean;\n  name: string;\n  given_name: string;\n  family_name: string;\n  picture: string;\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const code = searchParams.get('code');\n    const state = searchParams.get('state');\n    const error = searchParams.get('error');\n\n    // Handle OAuth errors\n    if (error) {\n      console.error('OAuth error:', error);\n      return NextResponse.redirect(\n        `${process.env.BASE_URL}/sign-in?error=oauth_denied`\n      );\n    }\n\n    if (!code || !state) {\n      return NextResponse.redirect(\n        `${process.env.BASE_URL}/sign-in?error=invalid_request`\n      );\n    }\n\n    // Verify state parameter\n    let stateData: { timestamp: number; type: string };\n    try {\n      stateData = JSON.parse(Buffer.from(state, 'base64').toString());\n      \n      // Check if state is not older than 10 minutes\n      if (Date.now() - stateData.timestamp > 10 * 60 * 1000) {\n        throw new Error('State expired');\n      }\n\n      if (stateData.type !== 'signin') {\n        throw new Error('Invalid state type');\n      }\n    } catch (err) {\n      console.error('Invalid state parameter:', err);\n      return NextResponse.redirect(\n        `${process.env.BASE_URL}/sign-in?error=invalid_state`\n      );\n    }\n\n    // Exchange code for tokens\n    const tokenResponse = await fetch(GOOGLE_TOKEN_URL, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        code,\n        client_id: process.env.GOOGLE_CLIENT_ID!,\n        client_secret: process.env.GOOGLE_CLIENT_SECRET!,\n        redirect_uri: `${process.env.BASE_URL}/api/auth/google/callback`,\n        grant_type: 'authorization_code',\n      }),\n    });\n\n    if (!tokenResponse.ok) {\n      const errorData = await tokenResponse.text();\n      console.error('Token exchange failed:', errorData);\n      return NextResponse.redirect(\n        `${process.env.BASE_URL}/sign-in?error=token_exchange_failed`\n      );\n    }\n\n    const tokens: GoogleTokenResponse = await tokenResponse.json();\n\n    // Get user info from Google\n    const userInfoResponse = await fetch(GOOGLE_USERINFO_URL, {\n      headers: {\n        Authorization: `Bearer ${tokens.access_token}`,\n      },\n    });\n\n    if (!userInfoResponse.ok) {\n      console.error('Failed to fetch user info');\n      return NextResponse.redirect(\n        `${process.env.BASE_URL}/sign-in?error=userinfo_failed`\n      );\n    }\n\n    const userInfo: GoogleUserInfo = await userInfoResponse.json();\n\n    if (!userInfo.verified_email) {\n      return NextResponse.redirect(\n        `${process.env.BASE_URL}/sign-in?error=email_not_verified`\n      );\n    }\n\n    // Check if user exists\n    const [existingUser] = await db\n      .select()\n      .from(users)\n      .where(eq(users.email, userInfo.email))\n      .limit(1);\n\n    let user: typeof existingUser;\n\n    if (existingUser) {\n      // User exists, sign them in\n      user = existingUser;\n\n      // Get their team\n      const [membership] = await db\n        .select()\n        .from(teamMembers)\n        .where(eq(teamMembers.userId, user.id))\n        .limit(1);\n\n      if (!membership) {\n        return NextResponse.redirect(\n          `${process.env.BASE_URL}/sign-in?error=no_team`\n        );\n      }\n    } else {\n      // New user, create account\n      // Create team first\n      const [newTeam] = await db\n        .insert(teams)\n        .values({\n          name: `${userInfo.name}'s Team`,\n        })\n        .returning();\n\n      // Create user (no password for OAuth users)\n      const [newUser] = await db\n        .insert(users)\n        .values({\n          email: userInfo.email,\n          name: userInfo.name,\n          passwordHash: '', // OAuth users don't have passwords\n          role: 'owner',\n        })\n        .returning();\n\n      user = newUser;\n\n      // Create team membership\n      await db.insert(teamMembers).values({\n        userId: user.id,\n        teamId: newTeam.id,\n        role: 'owner',\n      });\n    }\n\n    // Create session\n    await setSession(user);\n\n    // Redirect to dashboard\n    return NextResponse.redirect(`${process.env.BASE_URL}/app/dashboard`);\n  } catch (error) {\n    console.error('Error in Google Sign-In callback:', error);\n    return NextResponse.redirect(\n      `${process.env.BASE_URL}/sign-in?error=server_error`\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}